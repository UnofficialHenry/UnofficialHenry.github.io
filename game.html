<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <title>Tic Tac Toe</title>
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8163315423715705"
     crossorigin="anonymous"></script>
  
  <style>
    html, body { height: 100%; margin: 0; }
    body {
      margin: 0;
      background: #0b1220;
      color: #e7eefc;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    .app {
      width: min(420px, 92vw);
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      display: grid;
      gap: 14px;
      text-align: center;
      padding-bottom: 54px;
      box-sizing: border-box;
    }
    #resultText {
      margin: 0;
      font-size: clamp(28px, 6vw, 44px);
      letter-spacing: 0.2px;
      min-height: 1.2em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    td {
      padding: 0;
    }
    .cell {
      width: 100%;
      aspect-ratio: 1 / 1;
      background: #0f1730;
      border: 1px solid #2a3a66;
      color: #e7eefc;
      font-size: clamp(26px, 8vw, 56px);
      font-weight: 700;
      cursor: pointer;
      display: grid;
      place-items: center;
      user-select: none;
    }
    .cell:hover {
      filter: brightness(1.12);
    }
    .cell:disabled {
      cursor: not-allowed;
      opacity: .85;
    }
    .win {
      outline: 3px solid #6aa6ff;
      outline-offset: -3px;
    }
    .btn {
      justify-self: center;
      display: inline-block;
      visibility: hidden;
      opacity: 0;
      pointer-events: none;
      padding: 12px 24px;
      border-radius: 14px;
      background: #1a2750;
      border: 2px solid rgba(255,255,255,0.8);
      color: #e7eefc;
      cursor: pointer;
      font: inherit;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 1px;
      margin-top: 20px;
    }
    .btn:hover {
      filter: brightness(1.08);
    }
    .btn:active {
      transform: scale(0.98);
    }
    .btn:focus-visible {
      outline: 3px solid white;
      outline-offset: 4px;
    }
    .footer-bar{
      position: fixed;
      left: 50%;
      bottom: 0;
      transform: translateX(-50%);
      width: 250px;
      max-width: calc(100vw - 24px);
      background: #1a2750;
      border: 2px solid rgba(255,255,255,0.8);
      border-bottom: 0;
      border-radius: 16px 16px 0 0;
      padding: 2px 14px 4px;
      display: flex;
      justify-content: center;
      gap: 18px;
      box-sizing: border-box;
      backdrop-filter: blur(2px);
    }
    .footer-link{
      color: #e7eefc;
      text-decoration: none;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.6px;
      padding: 6px 10px;
      border-radius: 10px;
    }
    .footer-link:hover{
      background: rgba(255,255,255,0.12);
    }
    .footer-link:focus-visible{
      outline: 3px solid white;
      outline-offset: 4px;
    }
    .footer-sep{
      color: rgba(231,238,252,0.75);
      font-weight: 700;
      font-size: 14px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      padding: 0 2px;
      user-select: none;
    }
    .board-wrap{
      width: min(92vw, 420px);
      height: min(92vw, 420px);
      max-width: calc(100dvh - 220px);
      max-height: calc(100dvh - 220px);
      margin: 0 auto;
    }
    #board{
      width: 100%;
      height: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    #board td{
      width: 33.333%;
      height: 33.333%;
    }
  </style>
</head>

<body>
  <div class="app" aria-label="Tic Tac Toe game">
    <h1 id="resultText"></h1>
    <div class="board-wrap">
      <table id="board" aria-label="Tic Tac Toe board"></table>
    </div>
    <button class="btn" id="playAgain" type="button">PLAY AGAIN</button>
  </div>

  <footer class="footer-bar" aria-label="Site links">
    <a class="footer-link" href="about.html">ABOUT</a>
    <span class="footer-sep" aria-hidden="true">|</span>
    <a class="footer-link" href="privacy.html">PRIVACY</a>
  </footer>

  <script type="module">
    import Minimax from "https://esm.sh/tic-tac-toe-minimax@1.0.8";
    const { ComputerMove } = Minimax;

    const huPlayer = "X";
    const aiPlayer = "O";
    const symbols = { huPlayer, aiPlayer };
    const DIFFICULTY = "Easy";

    const $board = document.getElementById("board");
    const $resultText = document.getElementById("resultText");
    const $playAgain = document.getElementById("playAgain");

    const WIN_LINES = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6],
    ];

    let board;
    let gameOver;
    let busy;
    let winningLine = null;

    function isEmptyCell(v) { return typeof v === "number"; }

    function buildBoardOnce() {
      if ($board.hasChildNodes()) return;
      for (let r = 0; r < 3; r++) {
        const tr = document.createElement("tr");
        for (let c = 0; c < 3; c++) {
          const idx = r * 3 + c;
          const td = document.createElement("td");
          const btn = document.createElement("button");
          btn.className = "cell";
          btn.type = "button";
          btn.dataset.index = String(idx);
          btn.setAttribute("aria-label", `Cell ${idx + 1}`);
          btn.addEventListener("click", onHumanMove);
          td.appendChild(btn);
          tr.appendChild(td);
        }
        $board.appendChild(tr);
      }
    }

    function render() {
      buildBoardOnce();
      const buttons = $board.querySelectorAll(".cell");
      buttons.forEach((btn) => {
        const idx = Number(btn.dataset.index);
        const v = board[idx];
        btn.textContent = isEmptyCell(v) ? "" : v;
        btn.disabled = gameOver || busy || !isEmptyCell(v);
        btn.classList.toggle("win", Boolean(winningLine && winningLine.includes(idx)));
      });
    }

    function getWinner() {
      for (const line of WIN_LINES) {
        const [a,b,c] = line;
        if (!isEmptyCell(board[a]) && board[a] === board[b] && board[a] === board[c]) {
          return { winner: board[a], line };
        }
      }
      if (!board.some(isEmptyCell)) return { winner: "draw", line: null };
      return { winner: null, line: null };
    }

    function setResultUI(resultKey) {
      // resultKey: "won" | "lost" | "draw" | null
      if (!resultKey) {
        $resultText.textContent = "";
        $resultText.style.color = "";
        $playAgain.style.visibility = "hidden";
        $playAgain.style.opacity = "0";
        $playAgain.style.pointerEvents = "none";
        return;
      }

      if (resultKey === "won") {
        $resultText.textContent = "YOU WON";
        $resultText.style.color = "#009933";
      } else if (resultKey === "lost") {
        $resultText.textContent = "YOU LOST";
        $resultText.style.color = "#cc0000";
      } else if (resultKey === "draw") {
        $resultText.textContent = "YOU DREW";
        $resultText.style.color = "#2563EB";
      } else {
        $resultText.textContent = "GAME OVER";
        $resultText.style.color = "#FFFFFF";
      }

      $playAgain.style.visibility = "visible";
      $playAgain.style.opacity = "1";
      $playAgain.style.pointerEvents = "auto";
      $playAgain.focus();
    }

    function endGame(result) {
      gameOver = true;
      winningLine = result.line;
      render();

      setTimeout(() => {
        if (result.winner === "draw") return setResultUI("draw");
        if (result.winner === huPlayer) return setResultUI("won");
        return setResultUI("lost");
      }, 450);
    }

    function newGame() {
      board = Array.from({ length: 9 }, (_, i) => i);
      gameOver = false;
      busy = false;
      winningLine = null;
      setResultUI(null);
      render();
    }

    function onHumanMove(e) {
      if (gameOver || busy) return;

      const idx = Number(e.currentTarget.dataset.index);
      if (!isEmptyCell(board[idx])) return;

      board[idx] = huPlayer;

      let result = getWinner();
      if (result.winner) return endGame(result);

      // AI move
      busy = true;
      render();

      setTimeout(() => {
        const aiIdx = ComputerMove(board, symbols, DIFFICULTY);
        if (typeof aiIdx === "number" && isEmptyCell(board[aiIdx])) {
          board[aiIdx] = aiPlayer;
        }

        busy = false;
        result = getWinner();
        if (result.winner) endGame(result);
        else render();
      }, 80);
    }

    $playAgain.addEventListener("click", newGame);

    newGame();
  </script>
</body>
</html>
